# CapsWriter GUI启动器使用说明

## 简介

CapsWriter GUI启动器是一个带有图形界面的客户端管理工具，提供：

- 🎙️ **客户端控制** - 启动、停止、重启CapsWriter客户端
- 📄 **实时日志** - 彩色分级日志显示
- 🔧 **系统托盘** - 可隐藏到系统托盘运行
- 📁 **配置管理** - 快速访问配置文件夹
- ⏱️ **智能进度提示** - 浮动窗口实时显示转录和AI校对进度

## 文件结构

GUI相关文件已整理到专门的目录中，根目录只保留一个便捷启动脚本：

```
项目根目录/
├── start_gui_silent.vbs      # VBS静默启动脚本（唯一启动入口）
└── gui/                      # GUI相关文件目录
    ├── tray_gui_launcher.py       # GUI启动器主程序
    ├── progress_indicator.py      # 浮动进度提示窗口
    └── test_progress_indicator.py # 进度窗口测试脚本
```

## 启动方法

### 方法1：VBS静默启动（推荐）
```vbs
# 双击运行项目根目录的静默启动脚本，完全静默启动，不显示任何命令行窗口
# GUI会直接出现，无黑色窗口闪现
start_gui_silent.vbs
```

### 方法2：直接Python启动（调试用）
```bash
venv\Scripts\python.exe gui\tray_gui_launcher.py
```

## 功能说明

### 主窗口功能

- **自动启动** - GUI启动时自动启动CapsWriter客户端
- **状态显示** - 实时显示客户端运行状态
- **控制按钮** - 启动/停止/重启/清空日志/隐藏到托盘/进度提示/测试颜色/退出程序
- **智能日志** - 自动识别不同类型的日志内容并用不同颜色显示
- **日志显示** - 实时彩色日志，支持滚动查看
- **智能退出** - 关闭窗口或点击"退出程序"会自动停止客户端

### 系统托盘功能

- **托盘图标状态指示** - 绿色=运行中，灰色=已停止
- **单击托盘图标** - 显示/隐藏主窗口
- **右键菜单** - 完整控制选项，包括进度提示窗口控制

### 🚀 智能进度提示功能

CapsWriter 提供智能浮动进度窗口，实时显示长语音转录和AI校对的处理状态：

#### 功能特点
- **自动触发** - 检测到转录或AI校对开始时自动显示
- **实时进度** - 显示当前处理阶段和详细进度信息
- **智能定位** - 浮动在屏幕右上角，不干扰工作
- **无焦点干扰** - 使用无边框窗口技术，彻底避免抢夺输入焦点
- **状态指示** - 不同阶段使用不同颜色和图标标识
- **自动隐藏** - 处理完成后自动隐藏（3-5秒延迟）

#### 进度阶段显示
1. **🎙️ 转录阶段** - 蓝色，显示已处理音频时长
2. **🤖 AI校对阶段** - 橙色，显示文本优化进度
3. **✅ 处理完成** - 绿色，显示总用时统计
4. **⚠️ 处理失败** - 红色，显示错误信息

#### 控制方式
- **GUI按钮** - 主界面"进度提示"按钮可手动显示/隐藏
- **托盘菜单** - 右键托盘图标选择"进度提示窗口"
- **右键隐藏** - 右键点击进度窗口可快速隐藏
- **自动管理** - 客户端启动时重置，停止时自动隐藏

#### 适用场景
- **长音频转录** - 超过30秒的音频处理
- **AI校对处理** - 需要几十秒的文本优化过程
- **后台监控** - 最小化GUI时仍可查看进度

### 🌈 智能日志颜色分类

CapsWriter GUI 会自动识别不同类型的日志内容，并用专门的颜色和字体样式显示：

#### 转录相关颜色
- 🤎 **原文** - 棕色斜体 (如：`原文：看上去还是 deu seek 的中文理解能力要强很多`)
- 💚 **AI校对** - 深绿色粗体 (如：`AI校对：看上去还是 DeepSeek 的中文理解能力要强很多`)
- 💜 **识别结果** - 靛青色粗体 (如：`识别结果：看上去还是 DeepSeek 的中文理解能力要强很多`)

#### 状态与统计颜色
- 🟧 **AI状态** - 深橙色 (如：`正在进行AI校对...`)
- 🍅 **时间统计** - 番茄红 (如：`转录时延：7.57s`, `AI校对时长：4.69s`)
- ⬜ **任务信息** - 灰色 (如：`任务标识：xxx`, `录音时长：4.55s`)

#### 基础状态颜色
- 🔵 **一般信息** - 蓝色
- 🟢 **成功信息** - 绿色
- 🟠 **警告信息** - 橙色  
- 🔴 **错误信息** - 红色

#### 颜色测试
点击GUI中的 **"测试颜色"** 按钮可以查看所有颜色效果的实际展示。

## 环境要求

### 依赖库
```bash
# 基本GUI依赖（通常已包含在Python中）
tkinter

# 系统托盘功能依赖
pip install pystray pillow
```

### 系统要求
- **Windows 7+** 
- **Python 3.7+**
- **已配置的CapsWriter虚拟环境**

## 使用流程

1. **启动GUI** - 双击项目根目录的 `start_gui_silent.vbs`
2. **自动启动客户端** - GUI启动后会自动启动CapsWriter客户端
3. **查看彩色日志** - 在日志区域实时查看客户端状态，不同类型内容自动用不同颜色显示
4. **进度监控** - 长语音处理时会自动显示浮动进度窗口  
5. **颜色测试** - 点击"测试颜色"按钮查看所有日志颜色效果
6. **隐藏到托盘** - 点击"隐藏到托盘"按钮（客户端继续运行）
7. **恢复窗口** - 单击系统托盘图标
8. **完全退出** - 点击"退出程序"按钮或关闭窗口（自动停止客户端并退出）

## 故障排除

### 常见问题

1. **GUI无法启动**
   ```bash
   # 检查虚拟环境
   venv\Scripts\python.exe --version
   
   # 检查依赖
   venv\Scripts\pip.exe list | grep pystray
   ```

2. **托盘图标不显示**
   - 检查Windows通知区域设置
   - 确保允许显示所有图标

3. **客户端启动失败**
   - 查看日志区域的错误信息
   - 确认 `scripts/start_client.py` 文件存在
   - 检查虚拟环境配置

### 调试模式

如需调试，在命令行中运行：
```bash
venv\Scripts\python.exe tray_gui_launcher.py
```

## 高级配置

### 开机自启动

**方法1：启动文件夹**
1. 按 `Win + R`，输入 `shell:startup`
2. 将项目根目录的 `start_gui_silent.vbs` 复制到启动文件夹

**方法2：任务计划程序**
1. 创建基本任务
2. 触发器设为"计算机启动时"
3. 操作选择VBS脚本路径

### 配置客户端

GUI提供快速访问配置的功能：
- 右键托盘图标 → "打开配置文件夹"
- 可编辑热词文件、配置文件等

## 技术特点

- **进程监控** - 实时监控客户端进程状态
- **智能日志** - 自动识别并分色显示原文、AI校对、结果等不同内容
- **异步日志** - 非阻塞的日志更新机制
- **优雅退出** - 确保进程正确停止
- **状态同步** - GUI和托盘状态实时同步
- **异常恢复** - 自动处理进程异常退出

---

**注意事项：**
- GUI启动时会自动启动CapsWriter客户端
- 关闭GUI窗口会完全退出程序并自动停止客户端
- 要保持客户端运行但隐藏窗口，请使用"隐藏到托盘"按钮
- 建议添加到开机自启动以获得最佳体验